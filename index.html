<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>Fchat</title>
<body>
  <div id="chat-header" class="chat-header">
  </div>
  <style>
    body { font-family: sans-serif; margin: 20px; }

    body.theme-light {
      --bg: #f0f2f5;
      --text: #1b1f26;
      --panel: #ffffff;
      --panel-border: #cccccc;
      --chat-bg: #ffffff;
      --chat-border: #cccccc;
      --bubble-incoming: #808080;
      --bubble-outgoing: #808080;
      --bubble-text: #1b1f26;
      --nickname: #000000; 
    }

    body.theme-dark {
      --bg: #1e1e1e;
      --text: #e6e6e6;
      --panel: #2a2a2a;
      --panel-border: #444444;
      --chat-bg: #2a2a2a;
      --chat-border: #444444;
      --bubble-incoming: #808080;
      --bubble-outgoing: #808080;
      --bubble-text: #ffffff;
      --nickname: #000000;
    }

    body.theme-lumia {
      --bg: #FAF9F6;
      --text: #333333;
      --panel: #F5EEDC;
      --panel-border: #DDDDDD;
      --chat-bg: #FFFFFF;
      --chat-border: #DDDDDD;
      --bubble-incoming: #FFF9C4;
      --bubble-outgoing: #FFF176; 
      --bubble-text: #333333;
      --nickname: #B8860B;
    }

    body.theme-Keket {
      --bg: #000000;
      --text: #FFFFFF;
      --panel: #808080;
      --panel-border: #8A2BE2;
      --chat-bg: #262626;
      --chat-border: #8A2BE2;
      --bubble-incoming: #7FFFD4;
      --bubble-outgoing: #4B0082;
      --bubble-text: #FFFFFF;
      --nickname: #7FFFD4; 
    }

    body.theme-cosmos {
      --bg: #0b0c10;
      --text: #c5c6c7;
      --panel: #1f2833;
      --panel-border: #45a29e;
      --chat-bg: #1f2833;
      --chat-border: #45a29e;
      --bubble-incoming: #0d3b66;
      --bubble-outgoing: #45a29e;
      --bubble-text: #ffffff;
      --nickname: #66fcf1;
    }

    body { background: var(--bg); color: var(--text); transition: background 200ms ease, color 200ms ease; }

    #chat {
      border:1px solid var(--chat-border);
      padding:10px;
      height:300px;
      overflow:auto;
      margin:0 500px 10px 0;
      background:var(--chat-bg);
      border-radius:8px;
    }

    body.light .updates {
      background: #f9f9f9;
      color: #222;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 12px;
    }
    body.light .updates summary {
      color: #007acc;
      cursor: pointer;
      font-weight: bold;
    }
    body.light .updates[open] {
      border-left: 3px solid #007acc;
    }

    body.dark .updates {
      background: #222;
      color: #eee;
      border: 1px solid #444;
      border-radius: 8px;
      padding: 12px;
    }
    body.dark .updates summary {
      color: #45a29e;
      cursor: pointer;
      font-weight: bold;
    }
    body.dark .updates[open] {
      border-left: 3px solid #45a29e;
    }

    body.turquoise .updates {
      background: #003333;
      color: #ccffff;
      border: 1px solid #006666;
      border-radius: 8px;
      padding: 12px;
    }
    body.turquoise .updates summary {
      color: #00cccc;
      cursor: pointer;
      font-weight: bold;
    }
    body.turquoise .updates[open] {
      border-left: 3px solid #00cccc;
    }

    .msg { display:flex; align-items:flex-start; margin:8px 0; }
    .avatar { width:40px; height:40px; border-radius:50%; margin-right:8px; object-fit:cover; border:1px solid #aaa; }

    .bubble { position:relative; padding:8px 12px; border-radius:12px; max-width:70%; word-wrap:break-word; }
    .bubble.incoming { background: var(--bubble-incoming); color: var(--bubble-text); }
    .bubble.outgoing { background: var(--bubble-outgoing); color: var(--bubble-text); }

    .nick { font-weight:bold; margin-right:6px; color: var(--nickname); }
    .time { display:block; font-size:11px; color:#555; text-align:right; margin-top:4px; }
    .user-id {
      color: #808080;
      font-size: 0.85em;
      margin-left: 6px;
      text-shadow: 1px 1px 2px #000000;
    }

    .deleteBtn { position:absolute; top:-10px; right:-10px; background:#e63946; border:none; border-radius:50%; width:22px; height:22px; color:#fff; cursor:pointer; font-size:14px; line-height:22px; text-align:center; display:none; }
    .bubble:hover .deleteBtn { display:block; }

    .chatImage { max-width:200px; border-radius:8px; margin-top:5px; }

    input, button { padding:6px; border:1px solid #ccc; border-radius:6px; margin:2px; cursor:pointer; }
    #sendBtn { background:#666; color:#fff; }
    #sendBtn:hover { background:#444; }

    .color-btn { width:140px; height:30px; color:#fff; border:none; border-radius:6px; cursor:pointer; }
    #avatarPreview { width:40px; height:40px; border:1px solid #aaa; border-radius:50%; object-fit:cover; margin-left:10px; vertical-align:middle; display:none; }

    #settingsBtn { position: fixed; right: 12px; top: 12px; background: var(--panel); border: 1px solid var(--panel-border); border-radius: 8px; padding: 6px 8px; cursor: pointer; z-index: 1000; }
    #settingsPanel { position: fixed; right: 12px; top: 52px; width: 240px; background: var(--panel); border: 1px solid var(--panel-border); border-radius: 12px; padding: 10px 12px; box-shadow: 0 10px 24px rgba(0,0,0,0.25); display: none; z-index: 1001; }
    #settingsPanel .row { margin:6px 0; }
    #settingsPanel input[type="radio"] { accent-color: #3b82f6; }

    #emojiBtn {
      font-size: 18px;
      padding: 4px 8px;
      margin-left: 4px;
      cursor: pointer;
    }

    #emojiPanel button {
      font-size: 20px;
      padding: 4px;
      margin: 2px;
      border: none;
      background: transparent;
      cursor: pointer;
    }

    #emojiPanel button:hover {
      transform: scale(1.2);
    }
  </style>
</head>
<body class="theme-light">
  <h2>Fchat</h2>

  <button id="settingsBtn" aria-label="–û—Ç–∫—Ä—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">‚öôÔ∏è</button>
  <div id="settingsPanel" role="dialog" aria-modal="true" aria-label="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">
    <div class="row"><strong>–¢–µ–º–∞:</strong></div>
    <div class="row"><label><input type="radio" name="theme" value="light"> –°–≤–µ—Ç–ª–∞—è</label></div>
    <div class="row"><label><input type="radio" name="theme" value="dark"> –¢—ë–º–Ω–∞—è</label></div>
    <div class="row"><label><input type="radio" name="theme" value="lumia"> –õ—é–º–∏—è</label></div>
    <div class="row"><label><input type="radio" name="theme" value="Keket"> –ö–µ–∫–µ—Ç</label></div>
    <div class="row"><label><input type="radio" name="theme" value="cosmos"> –¢—ë–º–Ω–∞—è –±–∏—Ä—é–∑–∞</label></div>
  </div>

  <div id="chat"></div>

  <div>
    <input id="nick" placeholder="–í–∞—à –Ω–∏–∫">
    <input id="nickColorInput" type="color" style="display:none;">
    <input id="bubbleColorInput" type="color" style="display:none;">
    <button id="nickColorBtn" class="color-btn">–¶–≤–µ—Ç –Ω–∏–∫–∞</button>
    <button id="bubbleColorBtn" class="color-btn">–¶–≤–µ—Ç –æ–±–ª–∞—á–∫–∞</button>
    <input id="avatarInput" type="file" accept="image/*" style="display:none;">
    <button id="avatarBtn">–í—ã–±—Ä–∞—Ç—å –∞–≤–∞—Ç–∞—Ä–∫—É</button>
    <img id="avatarPreview" src="" alt="–ü—Ä–µ–≤—å—é">
  </div>
  <div>
    <input id="text" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ" style="width:300px;">
    <button id="emojiBtn">=)</button>
    <input id="fileInput" type="file" accept="image/*">
    <button id="sendBtn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
  </div>

  <div id="emojiPanel" style="display:none; margin-top:6px;">
    <button>=)</button>
    <button>=(</button>
    <button>=3</button>
    <button>=0</button>
    <button>(‚âß‚ñΩ‚â¶)</button>
     <button>(‚äô_‚òâ)</button>
<button>(ÔºõÔºøÔºõ)</button>
<button>¬Ø\_(„ÉÑ)_/¬Ø</button>
<button>(‚ïØ¬∞‚ñ°¬∞Ôºâ‚ïØÔ∏µ ‚îª‚îÅ‚îª</button>
<button>-_-</button>
<button>–æ_–û</button>
<button>(Õ°¬∞ Õú ñ Õ°¬∞)</button>
  </div>
  <details>
    <summary>–û Fchat</summary>
    <strong>Fchat ‚Äî —á–∞—Ç —Å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–æ–º.</strong>  
    –≠—Ç–æ —Å–∞–π—Ç –¥–ª—è –æ–±—â–µ–Ω–∏—è, –≥–¥–µ –∫–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID, –º–æ–∂–µ—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —Ü–≤–µ—Ç –Ω–∏–∫–∞, —Ü–≤–µ—Ç –æ–±–ª–∞—á–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π, –∞–≤–∞—Ç–∞—Ä –∏ —Å—Ç–∏–ª—å.  
    –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ç–µ–º—ã –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è, —ç–º–æ–¥–∑–∏‚Äë–ø–∞–Ω–µ–ª—å, –æ—Ç–ø—Ä–∞–≤–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ –º–∏–Ω–∏‚Äë–∏–≥—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, üé≤ –∫—É–±–∏–∫).
  </details>

  <details>
    <summary>–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è</summary>
    <ul>
      <li>–ü–æ—Å–ª–µ –∑–∞—Ö–æ–¥–∞ –Ω–∞ —Å–∞–π—Ç –≤–∞–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–¥–∞—ë—Ç—Å—è —Å–ª—É—á–∞–π–Ω—ã–π ID. –û–Ω –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ —Ä—è–¥–æ–º —Å –≤–∞—à–∏–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ ‚Äî —ç—Ç–æ –≤–∞—à ¬´–ø–∞—Å–ø–æ—Ä—Ç¬ª –≤ —á–∞—Ç–µ.</li>
      <li>–í–≤–µ–¥–∏—Ç–µ —Å–≤–æ—ë –∏–º—è –∏–ª–∏ –ø—Å–µ–≤–¥–æ–Ω–∏–º –≤ –ø–æ–ª–µ ¬´–ù–∏–∫¬ª. –ï—Å–ª–∏ –ø–æ–ª–µ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º ‚Äî –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –Ω–∏–∫–Ω–µ–π–º ¬´Anon¬ª.</li>
      <li>–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ü–≤–µ—Ç –Ω–∏–∫–∞ –∏ –æ–±–ª–∞—á–∫–∞ (—Ñ–æ–Ω —Å–æ–æ–±—â–µ–Ω–∏—è) —á–µ—Ä–µ–∑ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏.</li>
      <li>–î–æ–±–∞–≤—å—Ç–µ –∞–≤–∞—Ç–∞—Ä–∫—É —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É ¬´–í—ã–±—Ä–∞—Ç—å –∞–≤–∞—Ç–∞—Ä–∫—É¬ª.</li>
      <li>–í –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∞ ¬´—à–µ—Å—Ç–µ—Ä—ë–Ω–∫–∞¬ª. –¢–∞–º –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Ç–µ–º—É –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è (—Å–≤–µ—Ç–ª–∞—è, —Ç—ë–º–Ω–∞—è, Lumia, Keket, –¢—ë–º–Ω–∞—è –±–∏—Ä—é–∑–∞).</li>
      <li>–ù–∞–ø–∏—à–∏—Ç–µ —Ç–µ–∫—Å—Ç –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞ –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –µ–≥–æ –∫–Ω–æ–ø–∫–æ–π ¬´–û—Ç–ø—Ä–∞–≤–∏—Ç—å¬ª –∏–ª–∏ –∫–ª–∞–≤–∏—à–µ–π Enter.</li>
      <li>–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é –∫–Ω–æ–ø–∫–∏ ¬´–í—ã–±–æ—Ä —Ñ–∞–π–ª–∞¬ª.</li>
      <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞–Ω–µ–ª—å ¬´=)¬ª –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —ç–º–æ–¥–∑–∏ –∏ –∫–∞–æ–º–æ–¥–∑–∏ .</li>
      <li>–í —á–∞—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ã –∫–æ–º–∞–Ω–¥—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä: <code>/dice</code> ‚Äî –±—Ä–æ—Å–æ–∫ –∫—É–±–∏–∫–∞ üé≤, <code>/msgs</code> ‚Äî –∫–æ–ª–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π –∑–∞ –≤—Å—ë –≤—Ä–µ–º—è üìä, <code>/8ball</code> ‚Äî —à—É—Ç–æ—á–Ω—ã–π —à–∞—Ä –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –∏ –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã üîÆ. </li>
    </ul>
  </details>

  <details>
    <summary>–ü—Ä–∞–≤–∏–ª–∞</summary>
    <ul>
      <li>–£–≤–∞–∂–∞–π—Ç–µ –¥—Ä—É–≥–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —á–∞—Ç–∞.</li>
      <li>–ó–∞–ø—Ä–µ—â–µ–Ω–æ –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª—è—Ç—å –Ω–µ–Ω–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–π –ª–µ–∫—Å–∏–∫–æ–π, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ø–∞–º –∏ —Ñ–ª—É–¥.</li>
      <li>–ó–∞–ø—Ä–µ—â–µ–Ω–æ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—Ç—å –ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –±–µ–∑ —Å–æ–≥–ª–∞—Å–∏—è –¥—Ä—É–≥–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞.</li>
      <li>–ú–∏–Ω–∏ –∏–≥—Ä—ã –∏ –∫–æ–º–∞–Ω–¥—ã –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω—ã –¥–ª—è —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è, –∞ –Ω–µ –¥–ª—è —Å–ø–∞–º–∞.</li>
      <li>–ó–∞–ø—Ä–µ—â–µ–Ω–æ –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª—ã (—Ñ–æ—Ç–æ, —Å–æ–æ–±—â–µ–Ω–∏—è) —Å —Ç–µ–º–æ–π 18+.</li>
    </ul>
  </details>

<details> <summary>–°–ø–∏—Å–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∏ –Ω–æ–≤–æ—Å—Ç–µ–π</summary> 
<ul> <li><strong>02.02.2026</strong> ‚Äî –ù–∞—á–∞–ª–æ –≤–µ–¥–µ–Ω–∏—è –∂—É—Ä–Ω–∞–ª–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π</li> 
<li><strong>02.02.2026</strong> ‚Äî –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —É–¥–∞–ª—è—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ —Å–æ–æ–±—â–µ–Ω–∏—è. –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π, –∫—Ç–æ –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è ‚Äî –∞–¥–º–∏–Ω ( ID 51599 ). </li> 
<li><strong>07.02.2026</strong> ‚Äî  –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã: <code>/msgs</code> –∏ <code>/8ball</code> </li> 
<li><strong>07.02.2026</strong> ‚Äî  –í –ø–∞–Ω–µ–ª–∏ —ç–º–æ–¥–∑–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Å–º–∞–π–ª—ã –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –∫–∞–æ–º–æ–¥–∑–∏ –∏ –¥—Ä—É–≥–∏–µ —ç–º–æ–¥–∑–∏.</li>
<li><strong>07.02.2026</strong> ‚Äî  –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –∫–∞–æ–º–æ–¥–∑–∏ –∏ —ç–º–æ–¥–∑–∏ –≤ –ø–∞–Ω–µ–ª—å —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —ç–º–æ–¥–∑–∏: =)  =(  =3  =0  (‚âß‚ñΩ‚â¶)  (‚äô_‚òâ)  (ÔºõÔºøÔºõ)  ¬Ø\_(„ÉÑ)_/¬Ø  (‚ïØ¬∞‚ñ°¬∞Ôºâ‚ïØÔ∏µ ‚îª‚îÅ‚îª  -_-  –æ_–û  (Õ°¬∞ Õú ñ Õ°¬∞). </li> 
 </ul> 
</details>


  <details>
    <summary>–ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å</summary>
    <ul>
      <li>ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞: <strong>51599</strong>, –Ω–∏–∫ ‚Äî <strong>Ikogdash</strong>.</li>
      <li>–í—ã –º–æ–∂–µ—Ç–µ —Å–≤—è–∑–∞—Ç—å—Å—è —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º —á–µ—Ä–µ–∑ Outlook Live: <em>ikogdash@hotmail.com</em>.</li>
      <li>–ú—ã —Ü–µ–Ω–∏–º –≤–∞—à–∏ –∏–¥–µ–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É: –¥–µ–ª–∏—Ç–µ—Å—å –æ—Ç–∑—ã–≤–∞–º–∏, –ø—Ä–µ–¥–ª–∞–≥–∞–π—Ç–µ –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, —Å–æ–æ–±—â–∞–π—Ç–µ –æ–± –æ—à–∏–±–∫–∞—Ö –∏ –æ –Ω–∞—Ä—É—à–∏—Ç–µ–ª—è—Ö –ø—Ä–∞–≤–∏–ª.</li>
    </ul>
  </details>

  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyATNSmCPnM1og0SO-zJsfD2w9AVC00wiBg",
      authDomain: "fchat-f223c.firebaseapp.com",
      databaseURL: "https://fchat-f223c-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "fchat-f223c",
      storageBucket: "fchat-f223c.appspot.com",
      messagingSenderId: "850391832152",
      appId: "1:850391832152:web:39c320446cd898c7859c2d",
      measurementId: "G-1EVPFPZHPF"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let avatarData = "";
    let nickColor = "";
    let bubbleColor = "";

    if (localStorage.getItem('fchat_nick')) {
      document.getElementById('nick').value = localStorage.getItem('fchat_nick');
    }

    if (localStorage.getItem('fchat_nickColor')) {
      nickColor = localStorage.getItem('fchat_nickColor');
    }

    if (localStorage.getItem('fchat_bubbleColor')) {
      bubbleColor = localStorage.getItem('fchat_bubbleColor');
    }

    if (localStorage.getItem('fchat_avatar')) {
      avatarData = localStorage.getItem('fchat_avatar');
      const preview = document.getElementById('avatarPreview');
      preview.src = avatarData;
      preview.style.display = "inline-block";
    }

    function saveSettings() {
      const nick = document.getElementById('nick').value.trim();
      localStorage.setItem('fchat_nick', nick);
      localStorage.setItem('fchat_nickColor', nickColor);
      localStorage.setItem('fchat_bubbleColor', bubbleColor);
    }

    function updateButtons() {
      const themeNick = getComputedStyle(document.body).getPropertyValue('--nickname').trim();
      document.getElementById('nickColorBtn').style.backgroundColor = nickColor || themeNick;

      const outgoingDefault = getComputedStyle(document.body).getPropertyValue('--bubble-outgoing').trim();
      document.getElementById('bubbleColorBtn').style.backgroundColor = bubbleColor || outgoingDefault;

      if (avatarData) {
        const preview = document.getElementById('avatarPreview');
        preview.src = avatarData;
        preview.style.display = "inline-block";
      }
      
      saveSettings();
    }

    function handleCommand(text) {
      if (text.startsWith("/dice")) {
        const roll = Math.floor(Math.random() * 6) + 1;
        return "üé≤ –í—ã–ø–∞–ª–æ: " + roll;
      }
if (text === "/msgs") {
  const msgCount = document.querySelectorAll('.msg').length;
  return `üìä –°–æ–æ–±—â–µ–Ω–∏–π –≤ —á–∞—Ç–µ: ${msgCount}`;
}
if (text.startsWith("/8ball") || text.startsWith("/ball")) {
  const answers = [
    "–î–∞, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ", "–ë–µ—Å—Å–ø–æ—Ä–Ω–æ", "–ú–Ω–µ –∫–∞–∂–µ—Ç—Å—è ‚Äî –¥–∞", "–í–µ—Ä–æ—è—Ç–Ω–µ–µ –≤—Å–µ–≥–æ",
    "–°–ø—Ä–æ—Å–∏ –ø–æ–∑–∂–µ", "–ù–µ –º–æ–≥—É —Å–µ–π—á–∞—Å —Å–∫–∞–∑–∞—Ç—å", "–°–∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä—É–π—Å—è –∏ —Å–ø—Ä–æ—Å–∏ –æ–ø—è—Ç—å",
    "–î–∞–∂–µ –Ω–µ –¥—É–º–∞–π", "–ú–æ–π –æ—Ç–≤–µ—Ç ‚Äî –Ω–µ—Ç", "–ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã –Ω–µ –æ—á–µ–Ω—å —Ö–æ—Ä–æ—à–∏–µ",
    "–í–µ—Å—å–º–∞ —Å–æ–º–Ω–∏—Ç–µ–ª—å–Ω–æ", "–ó–Ω–∞–∫–∏ –≥–æ–≤–æ—Ä—è—Ç ‚Äî –¥–∞"
  ];
  return `üîÆ ${answers[Math.floor(Math.random() * answers.length)]}`;
}
      return null;
    }


         
    function addMessage(msg, key) {
      const chat = document.getElementById('chat');
      const wrapper = document.createElement('div');
      wrapper.className = "msg";
      wrapper.dataset.messageKey = key; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–ª—é—á —Å–æ–æ–±—â–µ–Ω–∏—è

      if (msg.avatar) {
        const img = document.createElement('img');
        img.className = "avatar";
        img.src = msg.avatar;
        wrapper.appendChild(img);
      }

      const bubbleEl = document.createElement('div');
      const currentNick = document.getElementById('nick').value.trim() || "Anon";
      const isOutgoing = msg.nick === currentNick;
      bubbleEl.className = "bubble " + (isOutgoing ? "outgoing" : "incoming");

      if (msg.bubbleColor) {
        bubbleEl.style.backgroundColor = msg.bubbleColor;
      }

      const themeNick = getComputedStyle(document.body).getPropertyValue('--nickname').trim();
      const textEl = document.createElement('div');
      textEl.innerHTML = `
        <span class="nick" style="color:${msg.color || themeNick}">${msg.nick}</span>
        <span class="user-id">ID:${msg.id}</span>: ${msg.text || ''}
      `;

      bubbleEl.appendChild(textEl);

      if (msg.image) {
        const imgEl = document.createElement('img');
        imgEl.className = "chatImage";
        imgEl.src = msg.image;
        bubbleEl.appendChild(imgEl);
      }

      const timeEl = document.createElement('div');
      timeEl.className = "time";
      timeEl.textContent = msg.time || '';
      bubbleEl.appendChild(timeEl);

      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–≤–æ–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∏–ª–∏ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
      const canDelete = msg.id === userID || userID === "51599";
      
      if (canDelete) {
        const delBtn = document.createElement('button');
        delBtn.className = "deleteBtn";
        delBtn.textContent = "X";
        delBtn.title = "–£–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ";
        
        delBtn.onclick = () => {
          let confirmationText = "–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ?";
          if (msg.id !== userID) {
            confirmationText = `–í—ã —É–¥–∞–ª—è–µ—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${msg.nick} (ID: ${msg.id}). –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?`;
          }
          
          if (confirm(confirmationText)) {
            db.ref("messages/" + key).remove().catch(err => {
              console.error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è:", err);
              alert("–£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å: " + err.code);
            });
            wrapper.remove();
          }
        };
        
        bubbleEl.appendChild(delBtn);
      }

      wrapper.appendChild(bubbleEl);
      chat.appendChild(wrapper);
      chat.scrollTop = chat.scrollHeight;
    }

    function send() {
      const nick = document.getElementById('nick').value.trim() || "Anon";
      const text = document.getElementById('text').value.trim();
      const fileInput = document.getElementById('fileInput');
      const file = fileInput.files[0];

      if (!text && !file) return;

      const now = new Date();
      const timeStr = now.getHours().toString().padStart(2,'0') + ":" + now.getMinutes().toString().padStart(2,'0');

      const msg = {
        nick,
        id: userID,
        text,
        color: nickColor || "",
        avatar: avatarData,
        bubbleColor: bubbleColor || "",
        time: timeStr
      };
      
      const commandResult = handleCommand(msg.text);
      if (commandResult) {
        addMessage({ nick: "FchatBot", text: commandResult, id: "BOT" });
      }

      const writeMsg = (m) => {
        const ref = db.ref("messages").push();
        ref.set(m).catch(err => {
          console.error("–û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏:", err);
          alert("–ó–∞–ø–∏—Å—å –Ω–µ —É–¥–∞–ª–∞—Å—å: " + err.code);
        });
      };

      if (file) {
        const reader = new FileReader();
        reader.onload = ev => { msg.image = ev.target.result; writeMsg(msg); };
        reader.readAsDataURL(file);
      } else {
        writeMsg(msg);
      }

      document.getElementById('text').value = '';
      fileInput.value = '';
    }

    db.ref("messages").on("child_added", snapshot => {
      addMessage(snapshot.val(), snapshot.key);
    }, err => {
      console.error("–û—à–∏–±–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏:", err);
      alert("–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —á—Ç–µ–Ω–∏—é: " + err.code);
    });

    document.getElementById('sendBtn').onclick = send;
    document.getElementById('text').addEventListener("keydown", e => {
      if (e.key === "Enter") { e.preventDefault(); send(); }
    });

    document.getElementById('nickColorBtn').onclick = () => document.getElementById('nickColorInput').click();
    document.getElementById('bubbleColorBtn').onclick = () => document.getElementById('bubbleColorInput').click();

    document.getElementById('nick').addEventListener('input', function() {
      saveSettings();
    });

    document.getElementById('nickColorInput').addEventListener("input", e => {
      nickColor = e.target.value;
      updateButtons();
      saveSettings();
    });
    
    document.getElementById('bubbleColorInput').addEventListener("input", e => {
      bubbleColor = e.target.value;
      updateButtons();
      saveSettings();
    });

    document.getElementById('avatarBtn').onclick = () => document.getElementById('avatarInput').click();
    document.getElementById('avatarInput').addEventListener("change", e => {
      const file = e.target.files[0]; 
      if (!file) return;
      const reader = new FileReader();
      reader.onload = ev => {
        avatarData = ev.target.result;
        const preview = document.getElementById('avatarPreview');
        preview.src = avatarData;
        preview.style.display = "inline-block";
        localStorage.setItem('fchat_avatar', avatarData);
      };
      reader.readAsDataURL(file);
    });

    const settingsBtn = document.getElementById('settingsBtn');
    const settingsPanel = document.getElementById('settingsPanel');
    const themeRadios = document.querySelectorAll('input[name="theme"]');

    const savedTheme = localStorage.getItem('fchat-theme') || 'light';
    document.body.classList.remove('theme-light','theme-dark','theme-lumia','theme-Keket');
    document.body.classList.add(`theme-${savedTheme}`);
    themeRadios.forEach(r => r.checked = r.value === savedTheme);

    settingsBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      const open = settingsPanel.style.display === 'block';
      settingsPanel.style.display = open ? 'none' : 'block';
    });

    document.addEventListener('click', (e) => {
      if (!settingsPanel.contains(e.target) && e.target !== settingsBtn) {
        settingsPanel.style.display = 'none';
      }
    });

    themeRadios.forEach(radio => {
      radio.addEventListener('change', (e) => {
        const val = e.target.value;
        document.body.classList.remove('theme-light','theme-dark','theme-lumia','theme-Keket','theme-cosmos');
        document.body.classList.add(`theme-${val}`);
        localStorage.setItem('fchat-theme', val);
        updateButtons();
      });
    });

    updateButtons();
    
    function addEmoji(emoji) {
      const input = document.getElementById('text');
      input.value += emoji;
      input.focus();
    }

    document.getElementById('emojiBtn').onclick = () => {
      const panel = document.getElementById('emojiPanel');
      panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
    };

    document.getElementById('emojiPanel').addEventListener('click', (e) => {
      if (e.target.tagName === 'BUTTON') {
        addEmoji(e.target.textContent);
      }
    });
  </script>
  
  <script>
    function generateID() {
      return Math.floor(10000 + Math.random() * 90000);
    }

    let userID = localStorage.getItem('fchat_user_id');
    if (!userID) {
      userID = generateID();
      localStorage.setItem('fchat_user_id', userID);
    }

    document.title = `Fchat ‚Äî —á–∞—Ç —Å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–æ–º | –í–∞—à ID: ${userID}`;

    const header = document.getElementById("chat-header");
    if (header) {
      header.innerHTML += ` <span style="color:gray; font-size:14px;">–í–∞—à ID: ${userID}</span>`;
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∏ –∫–Ω–æ–ø–æ–∫ —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    function updateDeleteButtons() {
      setTimeout(() => {
        const messages = document.querySelectorAll('.msg');
        messages.forEach(wrapper => {
          const bubble = wrapper.querySelector('.bubble');
          if (!bubble) return;
          
          const existingBtn = bubble.querySelector('.deleteBtn');
          if (existingBtn) existingBtn.remove();
          
          // –ü–æ–ª—É—á–∞–µ–º ID —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
          const userIdSpan = bubble.querySelector('.user-id');
          if (!userIdSpan) return;
          
          const userIdMatch = userIdSpan.textContent.match(/ID:(\d+)/);
          if (!userIdMatch) return;
          
          const messageUserId = userIdMatch[1];
          
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–≤–æ–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∏–ª–∏ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
          if (messageUserId === userID || userID === "51599") {
            const delBtn = document.createElement('button');
            delBtn.className = "deleteBtn";
            delBtn.textContent = "X";
            delBtn.title = "–£–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ";
            
            const messageKey = wrapper.dataset.messageKey;
            
            delBtn.onclick = () => {
              let confirmationText = "–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ?";
              
              // –ï—Å–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —É–¥–∞–ª—è–µ—Ç –Ω–µ —Å–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
              if (userID === "51599" && messageUserId !== userID) {
                const nickSpan = bubble.querySelector('.nick');
                const nick = nickSpan ? nickSpan.textContent : "–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å";
                confirmationText = `–í—ã —É–¥–∞–ª—è–µ—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${nick} (ID: ${messageUserId}). –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?`;
              }
              
              if (confirm(confirmationText)) {
                db.ref("messages/" + messageKey).remove().catch(err => {
                  console.error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è:", err);
                  alert("–£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å: " + err.code);
                });
                wrapper.remove();
              }
            };
            
            bubble.appendChild(delBtn);
          }
        });
      }, 1000);
    }

    // –í—ã–∑—ã–≤–∞–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', updateDeleteButtons);
    
    // –¢–∞–∫–∂–µ –≤—ã–∑—ã–≤–∞–µ–º –ø—Ä–∏ –∫–∞–∂–¥–æ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
    const originalAddMessage = window.addMessage;
    if (originalAddMessage) {
      window.addMessage = function(msg, key) {
        const result = originalAddMessage(msg, key);
        setTimeout(updateDeleteButtons, 100);
        return result;
      };
    }
  </script>

  <footer style="text-align:center; padding:10px; font-size:14px; color:#888;">
    ¬© Ikogdash, 2025-2026
  </footer>
</body>
</html>
