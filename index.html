<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>Fchat</title>
<body>
  <div id="chat-header" class="chat-header">
  </div>
  <style>
    body { font-family: sans-serif; margin: 20px; }

    /* –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ */
    body.theme-light {
      --bg: #f0f2f5;
      --text: #1b1f26;
      --panel: #ffffff;
      --panel-border: #cccccc;
      --chat-bg: #ffffff;
      --chat-border: #cccccc;
      --bubble-incoming: #808080;
      --bubble-outgoing: #808080;
      --bubble-text: #1b1f26;
      --nickname: #000000; 
    }

    /* –¢—ë–º–Ω–∞—è —Ç–µ–º–∞ */
    body.theme-dark {
      --bg: #1e1e1e;
      --text: #e6e6e6;
      --panel: #2a2a2a;
      --panel-border: #444444;
      --chat-bg: #2a2a2a;
      --chat-border: #444444;
      --bubble-incoming: #808080;
      --bubble-outgoing: #808080;
      --bubble-text: #ffffff;
      --nickname: #000000;
    }

    /* üåû –õ—é–º–∏—è */
    body.theme-lumia {
      --bg: #FAF9F6;
      --text: #333333;
      --panel: #F5EEDC;
      --panel-border: #DDDDDD;
      --chat-bg: #FFFFFF;
      --chat-border: #DDDDDD;
      --bubble-incoming: #FFF9C4;
      --bubble-outgoing: #FFF176; 
      --bubble-text: #333333;
      --nickname: #B8860B;
    }

    /* üåë –ö–µ–∫–µ—Ç */
    body.theme-Keket {
      --bg: #000000;
      --text: #FFFFFF;
      --panel: #808080;
      --panel-border: #8A2BE2;
      --chat-bg: #262626;
      --chat-border: #8A2BE2;
      --bubble-incoming: #7FFFD4;
      --bubble-outgoing: #4B0082;
      --bubble-text: #FFFFFF;
      --nickname: #7FFFD4; 
    }
/* üåå –ö–æ—Å–º–æ—Å */
body.theme-cosmos {
  --bg: #0b0c10;            /* –≥–ª—É–±–æ–∫–∏–π —Ç—ë–º–Ω—ã–π —Ñ–æ–Ω */
  --text: #c5c6c7;          /* —Å–≤–µ—Ç–ª—ã–π —Ç–µ–∫—Å—Ç */
  --panel: #1f2833;         /* –ø–∞–Ω–µ–ª—å –≤ —Å—Ç–∏–ª–µ –∫–æ—Å–º–æ—Å–∞ */
  --panel-border: #45a29e;  /* –±–∏—Ä—é–∑–æ–≤–∞—è —Ä–∞–º–∫–∞ */
  --chat-bg: #1f2833;
  --chat-border: #45a29e;
  --bubble-incoming: #0d3b66; /* —Ç—ë–º–Ω–æ-—Å–∏–Ω–∏–π –¥–ª—è –≤—Ö–æ–¥—è—â–∏—Ö */
  --bubble-outgoing: #45a29e; /* –Ω–µ–æ–Ω-–±–∏—Ä—é–∑–æ–≤—ã–π –¥–ª—è –∏—Å—Ö–æ–¥—è—â–∏—Ö */
  --bubble-text: #ffffff;
  --nickname: #66fcf1;       /* —è—Ä–∫–∏–π –Ω–µ–æ–Ω –¥–ª—è –Ω–∏–∫–æ–≤ */
}

    /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ */
    body { background: var(--bg); color: var(--text); transition: background 200ms ease, color 200ms ease; }

    #chat {
      border:1px solid var(--chat-border);
      padding:10px;
      height:300px;
      overflow:auto;
      margin:0 500px 10px 0; /* –æ—Ç—Å—Ç—É–ø —Å–ø—Ä–∞–≤–∞ */
      background:var(--chat-bg);
      border-radius:8px;
    }
  /* –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ */
body.light .updates {
  background: #f9f9f9;
  color: #222;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 12px;
}
body.light .updates summary {
  color: #007acc;
  cursor: pointer;
  font-weight: bold;
}
body.light .updates[open] {
  border-left: 3px solid #007acc;
}

/* –¢—ë–º–Ω–∞—è —Ç–µ–º–∞ */
body.dark .updates {
  background: #222;
  color: #eee;
  border: 1px solid #444;
  border-radius: 8px;
  padding: 12px;
}
body.dark .updates summary {
  color: #45a29e;
  cursor: pointer;
  font-weight: bold;
}
body.dark .updates[open] {
  border-left: 3px solid #45a29e;
}

/* –ë–∏—Ä—é–∑–æ–≤–∞—è —Ç–µ–º–∞ */
body.turquoise .updates {
  background: #003333;
  color: #ccffff;
  border: 1px solid #006666;
  border-radius: 8px;
  padding: 12px;
}
body.turquoise .updates summary {
  color: #00cccc;
  cursor: pointer;
  font-weight: bold;
}
body.turquoise .updates[open] {
  border-left: 3px solid #00cccc;
}

    .msg { display:flex; align-items:flex-start; margin:8px 0; }
    .avatar { width:40px; height:40px; border-radius:50%; margin-right:8px; object-fit:cover; border:1px solid #aaa; }

    .bubble { position:relative; padding:8px 12px; border-radius:12px; max-width:70%; word-wrap:break-word; }
    .bubble.incoming { background: var(--bubble-incoming); color: var(--bubble-text); }
    .bubble.outgoing { background: var(--bubble-outgoing); color: var(--bubble-text); }

    .nick { font-weight:bold; margin-right:6px; color: var(--nickname); }
    .time { display:block; font-size:11px; color:#555; text-align:right; margin-top:4px; }
    .user-id {
  color: #777;
  font-size: 0.85em;
  margin-left: 6px;
}


    .deleteBtn { position:absolute; top:-10px; right:-10px; background:#e63946; border:none; border-radius:50%; width:22px; height:22px; color:#fff; cursor:pointer; font-size:14px; line-height:22px; text-align:center; display:none; }
    .bubble:hover .deleteBtn { display:block; }

    .chatImage { max-width:200px; border-radius:8px; margin-top:5px; }

    input, button { padding:6px; border:1px solid #ccc; border-radius:6px; margin:2px; cursor:pointer; }
    #sendBtn { background:#666; color:#fff; }
    #sendBtn:hover { background:#444; }

    .color-btn { width:140px; height:30px; color:#fff; border:none; border-radius:6px; cursor:pointer; }
    #avatarPreview { width:40px; height:40px; border:1px solid #aaa; border-radius:50%; object-fit:cover; margin-left:10px; vertical-align:middle; display:none; }

    #settingsBtn { position: fixed; right: 12px; top: 12px; background: var(--panel); border: 1px solid var(--panel-border); border-radius: 8px; padding: 6px 8px; cursor: pointer; z-index: 1000; }
    #settingsPanel { position: fixed; right: 12px; top: 52px; width: 240px; background: var(--panel); border: 1px solid var(--panel-border); border-radius: 12px; padding: 10px 12px; box-shadow: 0 10px 24px rgba(0,0,0,0.25); display: none; z-index: 1001; }
    #settingsPanel .row { margin:6px 0; }
    #settingsPanel input[type="radio"] { accent-color: #3b82f6; }

#emojiBtn {
  font-size: 18px;
  padding: 4px 8px;
  margin-left: 4px;
  cursor: pointer;
}

#emojiPanel button {
  font-size: 20px;
  padding: 4px;
  margin: 2px;
  border: none;
  background: transparent;
  cursor: pointer;
}

#emojiPanel button:hover {
  transform: scale(1.2);
}

</style>
</head>
<body class="theme-light">
  <h2>Fchat</h2>

  <!-- –ü–∞–Ω–µ–ª—å –≤—ã–±–æ—Ä–∞ —Ç–µ–º—ã -->
  <button id="settingsBtn" aria-label="–û—Ç–∫—Ä—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">‚öôÔ∏è</button>
  <div id="settingsPanel" role="dialog" aria-modal="true" aria-label="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">
    <div class="row"><strong>–¢–µ–º–∞:</strong></div>
    <div class="row"><label><input type="radio" name="theme" value="light"> –°–≤–µ—Ç–ª–∞—è</label></div>
    <div class="row"><label><input type="radio" name="theme" value="dark"> –¢—ë–º–Ω–∞—è</label></div>
    <div class="row"><label><input type="radio" name="theme" value="lumia"> –õ—é–º–∏—è</label></div>
    <div class="row"><label><input type="radio" name="theme" value="Keket"> –ö–µ–∫–µ—Ç</label></div>
<div class="row"><label><input type="radio" name="theme" value="cosmos"> –¢—ë–º–Ω–∞—è –±–∏—Ä—é–∑–∞</label></div>
  </div>

  <div id="chat"></div>

  <div>
    <input id="nick" placeholder="–í–∞—à –Ω–∏–∫">
    <input id="nickColorInput" type="color" style="display:none;">
    <input id="bubbleColorInput" type="color" style="display:none;">
    <button id="nickColorBtn" class="color-btn">–¶–≤–µ—Ç –Ω–∏–∫–∞</button>
    <button id="bubbleColorBtn" class="color-btn">–¶–≤–µ—Ç –æ–±–ª–∞—á–∫–∞</button>
    <input id="avatarInput" type="file" accept="image/*" style="display:none;">
    <button id="avatarBtn">–í—ã–±—Ä–∞—Ç—å –∞–≤–∞—Ç–∞—Ä–∫—É</button>
    <img id="avatarPreview" src="" alt="–ü—Ä–µ–≤—å—é">
  </div>
<div>
  <input id="text" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ" style="width:300px;">
  <button id="emojiBtn">üòä</button>
  <input id="fileInput" type="file" accept="image/*">
  <button id="sendBtn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
</div>

<!-- –ü–∞–Ω–µ–ª—å —ç–º–æ–¥–∑–∏ -->
<div id="emojiPanel" style="display:none; margin-top:6px;">
  <button>üòÄ</button>
  <button>ü§£</button>
  <button>üòê</button>
  <button>üòï</button>
  <button>üò§</button>
</div>
<details>
  <summary>–û Fchat</summary>
  <strong>Fchat ‚Äî —á–∞—Ç —Å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–æ–º.</strong>  
  –≠—Ç–æ —Å–∞–π—Ç –¥–ª—è –æ–±—â–µ–Ω–∏—è, –≥–¥–µ –∫–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID, –º–æ–∂–µ—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —Ü–≤–µ—Ç –Ω–∏–∫–∞, —Ü–≤–µ—Ç –æ–±–ª–∞—á–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π, –∞–≤–∞—Ç–∞—Ä –∏ —Å—Ç–∏–ª—å.  
  –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ç–µ–º—ã –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è, —ç–º–æ–¥–∑–∏‚Äë–ø–∞–Ω–µ–ª—å, –æ—Ç–ø—Ä–∞–≤–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ –º–∏–Ω–∏‚Äë–∏–≥—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, üé≤ –∫—É–±–∏–∫).
</details>

<details>
  <summary>–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è</summary>
  <ul>
    <li>–ü–æ—Å–ª–µ –∑–∞—Ö–æ–¥–∞ –Ω–∞ —Å–∞–π—Ç –≤–∞–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–¥–∞—ë—Ç—Å—è —Å–ª—É—á–∞–π–Ω—ã–π ID. –û–Ω –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ —Ä—è–¥–æ–º —Å –≤–∞—à–∏–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ ‚Äî —ç—Ç–æ –≤–∞—à ¬´–ø–∞—Å–ø–æ—Ä—Ç¬ª –≤ —á–∞—Ç–µ.</li>
    <li>–í–≤–µ–¥–∏—Ç–µ —Å–≤–æ—ë –∏–º—è –∏–ª–∏ –ø—Å–µ–≤–¥–æ–Ω–∏–º –≤ –ø–æ–ª–µ ¬´–ù–∏–∫¬ª. –ï—Å–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º ‚Äî –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è ¬´Anon¬ª.</li>
    <li>–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ü–≤–µ—Ç –Ω–∏–∫–∞ –∏ –æ–±–ª–∞—á–∫–∞ (—Ñ–æ–Ω —Å–æ–æ–±—â–µ–Ω–∏—è) —á–µ—Ä–µ–∑ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏.</li>
    <li>–î–æ–±–∞–≤—å—Ç–µ –∞–≤–∞—Ç–∞—Ä–∫—É —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É ¬´–í—ã–±—Ä–∞—Ç—å –∞–≤–∞—Ç–∞—Ä–∫—É¬ª.</li>
    <li>–í –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∞ ¬´—à–µ—Å—Ç–µ—Ä—ë–Ω–∫–∞¬ª. –¢–∞–º –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Ç–µ–º—É –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è (—Å–≤–µ—Ç–ª–∞—è, —Ç—ë–º–Ω–∞—è, Lumia, Keket, –¢—ë–º–Ω–∞—è –±–∏—Ä—é–∑–∞).</li>
    <li>–ù–∞–ø–∏—à–∏—Ç–µ —Ç–µ–∫—Å—Ç –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞ –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –µ–≥–æ –∫–Ω–æ–ø–∫–æ–π ¬´–û—Ç–ø—Ä–∞–≤–∏—Ç—å¬ª –∏–ª–∏ –∫–ª–∞–≤–∏—à–µ–π Enter.</li>
    <li>–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é –∫–Ω–æ–ø–∫–∏ ¬´–í—ã–±–æ—Ä —Ñ–∞–π–ª–∞¬ª.</li>
    <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞–Ω–µ–ª—å ¬´üòä¬ª –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ —ç–º–æ–¥–∑–∏.</li>
    <li>–í —á–∞—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ã –∫–æ–º–∞–Ω–¥—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä: <code>/dice</code> ‚Äî –±—Ä–æ—Å–æ–∫ –∫—É–±–∏–∫–∞ üé≤.</li>
  </ul>
</details>

<details>
  <summary>–ü—Ä–∞–≤–∏–ª–∞</summary>
  <ul>
    <li>–£–≤–∞–∂–∞–π—Ç–µ –¥—Ä—É–≥–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —á–∞—Ç–∞.</li>
    <li>–ó–∞–ø—Ä–µ—â–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ–Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—É—é –ª–µ–∫—Å–∏–∫—É, —Å–ø–∞–º –∏ —Ñ–ª—É–¥.</li>
    <li>–ó–∞–ø—Ä–µ—â–µ–Ω–æ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—Ç—å –ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –±–µ–∑ —Å–æ–≥–ª–∞—Å–∏—è –¥—Ä—É–≥–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞.</li>
    <li>–ú–∏–Ω–∏‚Äë–∏–≥—Ä—ã –∏ –∫–æ–º–∞–Ω–¥—ã –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω—ã –¥–ª—è —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è, –∞ –Ω–µ –¥–ª—è —Å–ø–∞–º–∞.</li>
    <li>–ó–∞–ø—Ä–µ—â–µ–Ω–æ –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª—ã (—Ñ–æ—Ç–æ, —Å–æ–æ–±—â–µ–Ω–∏—è) —Å —Ç–µ–º–æ–π 18+.</li>
  </ul>
</details>

<details>
  <summary>–ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å</summary>
  <ul>
    <li>ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞: <strong>51599</strong>, –Ω–∏–∫ ‚Äî <strong>Ikogdash</strong>.</li>
    <li>–í—ã –º–æ–∂–µ—Ç–µ —Å–≤—è–∑–∞—Ç—å—Å—è —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º —á–µ—Ä–µ–∑ Outlook Live: <em>ikogdash@hotmail.com</em>.</li>
    <li>–ú—ã —Ü–µ–Ω–∏–º –≤–∞—à–∏ –∏–¥–µ–∏ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è: –¥–µ–ª–∏—Ç–µ—Å—å –æ—Ç–∑—ã–≤–∞–º–∏, –ø—Ä–µ–¥–ª–∞–≥–∞–π—Ç–µ –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ —Å–æ–æ–±—â–∞–π—Ç–µ –æ–± –æ—à–∏–±–∫–∞—Ö –∏ –æ –Ω–∞—Ä—É—à–∏—Ç–µ–ª—è—Ö –ø—Ä–∞–≤–∏–ª.</li>
  </ul>
</details>




 
  <!-- Firebase compat -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

  <script>
    // –¢–≤–æ–π –∫–æ–Ω—Ñ–∏–≥ (–∏–∑ –≤—Ç–æ—Ä–æ–π —á–∞—Å—Ç–∏)
    const firebaseConfig = {
      apiKey: "AIzaSyATNSmCPnM1og0SO-zJsfD2w9AVC00wiBg",
      authDomain: "fchat-f223c.firebaseapp.com",
      databaseURL: "https://fchat-f223c-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "fchat-f223c",
      storageBucket: "fchat-f223c.appspot.com",
      messagingSenderId: "850391832152",
      appId: "1:850391832152:web:39c320446cd898c7859c2d",
      measurementId: "G-1EVPFPZHPF"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // –õ–æ–∫–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
    let avatarData = "";
    let nickColor = "";     // –ø—É—Å—Ç–æ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ü–≤–µ—Ç —Ç–µ–º—ã (--nickname)
    let bubbleColor = "";   // –ø—É—Å—Ç–æ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ü–≤–µ—Ç —Ç–µ–º—ã (--bubble-outgoing)

    function updateButtons() {
      const themeNick = getComputedStyle(document.body).getPropertyValue('--nickname').trim();
      document.getElementById('nickColorBtn').style.backgroundColor = nickColor || themeNick;

      const outgoingDefault = getComputedStyle(document.body).getPropertyValue('--bubble-outgoing').trim();
      document.getElementById('bubbleColorBtn').style.backgroundColor = bubbleColor || outgoingDefault;

      if (avatarData) {
        const preview = document.getElementById('avatarPreview');
        preview.src = avatarData;
        preview.style.display = "inline-block";
      }
    }
function handleCommand(text) {
  if (text.startsWith("/dice")) {
    const roll = Math.floor(Math.random() * 6) + 1;
    return "üé≤ –í—ã–ø–∞–ª–æ: " + roll;
  }
  return null;
}
     
    function addMessage(msg, key) {
      const chat = document.getElementById('chat');
      const wrapper = document.createElement('div');
      wrapper.className = "msg";

      if (msg.avatar) {
        const img = document.createElement('img');
        img.className = "avatar";
        img.src = msg.avatar;
        wrapper.appendChild(img);
      }

      const bubbleEl = document.createElement('div');
      const currentNick = document.getElementById('nick').value.trim() || "Anon";
      const isOutgoing = msg.nick === currentNick;
      bubbleEl.className = "bubble " + (isOutgoing ? "outgoing" : "incoming");

      if (msg.bubbleColor) {
        bubbleEl.style.backgroundColor = msg.bubbleColor;
      }

      const themeNick = getComputedStyle(document.body).getPropertyValue('--nickname').trim();
      const textEl = document.createElement('div');
      textEl.innerHTML = `
  <span class="nick" style="color:${msg.color || themeNick}">${msg.nick}</span>
  <span class="user-id">ID:${msg.id}</span>: ${msg.text || ''}
`;


      bubbleEl.appendChild(textEl);

      if (msg.image) {
        const imgEl = document.createElement('img');
        imgEl.className = "chatImage";
        imgEl.src = msg.image;
        bubbleEl.appendChild(imgEl);
      }

      const timeEl = document.createElement('div');
      timeEl.className = "time";
      timeEl.textContent = msg.time || '';
      bubbleEl.appendChild(timeEl);

      const delBtn = document.createElement('button');
      delBtn.className = "deleteBtn";
      delBtn.textContent = "X";
      delBtn.onclick = () => {
        db.ref("messages/" + key).remove().catch(err => {
          console.error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è:", err);
          alert("–£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å: " + err.code);
        });
        wrapper.remove();
      };
      bubbleEl.appendChild(delBtn);

      wrapper.appendChild(bubbleEl);
      chat.appendChild(wrapper);
      chat.scrollTop = chat.scrollHeight;
    }

    function send() {
      const nick = document.getElementById('nick').value.trim() || "Anon";
      const text = document.getElementById('text').value.trim();
      const fileInput = document.getElementById('fileInput');
      const file = fileInput.files[0];

      if (!text && !file) return;

      const now = new Date();
      const timeStr = now.getHours().toString().padStart(2,'0') + ":" + now.getMinutes().toString().padStart(2,'0');

      const msg = {
        nick,
         id: userID,
        text,
        color: nickColor || "",     // –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ü–≤–µ—Ç –Ω–∏–∫–∞ (–µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω)
        avatar: avatarData,
        bubbleColor: bubbleColor || "",
        time: timeStr
      };
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–º–∞–Ω–¥—ã
const commandResult = handleCommand(msg.text);
if (commandResult) {
  addMessage({ nick: "FchatBot", text: commandResult, id: "BOT" });
}

      const writeMsg = (m) => {
        const ref = db.ref("messages").push();
        ref.set(m).catch(err => {
          console.error("–û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏:", err);
          alert("–ó–∞–ø–∏—Å—å –Ω–µ —É–¥–∞–ª–∞—Å—å: " + err.code);
        });
      };

      if (file) {
        const reader = new FileReader();
        reader.onload = ev => { msg.image = ev.target.result; writeMsg(msg); };
        reader.readAsDataURL(file);
      } else {
        writeMsg(msg);
      }

      document.getElementById('text').value = '';
      fileInput.value = '';
    }

    // –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    db.ref("messages").on("child_added", snapshot => {
      addMessage(snapshot.val(), snapshot.key);
    }, err => {
      console.error("–û—à–∏–±–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏:", err);
      alert("–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —á—Ç–µ–Ω–∏—é: " + err.code);
    });

    // UI —Å–æ–±—ã—Ç–∏—è
    document.getElementById('sendBtn').onclick = send;
    document.getElementById('text').addEventListener("keydown", e => {
      if (e.key === "Enter") { e.preventDefault(); send(); }
    });

    document.getElementById('nickColorBtn').onclick = () => document.getElementById('nickColorInput').click();
    document.getElementById('bubbleColorBtn').onclick = () => document.getElementById('bubbleColorInput').click();

    document.getElementById('nickColorInput').addEventListener("input", e => {
      nickColor = e.target.value;
      updateButtons();
    });
    document.getElementById('bubbleColorInput').addEventListener("input", e => {
      bubbleColor = e.target.value;
      updateButtons();
    });

    document.getElementById('avatarBtn').onclick = () => document.getElementById('avatarInput').click();
    document.getElementById('avatarInput').addEventListener("change", e => {
      const file = e.target.files[0]; if (!file) return;
      const reader = new FileReader();
      reader.onload = ev => {
        avatarData = ev.target.result;
        const preview = document.getElementById('avatarPreview');
        preview.src = avatarData;
        preview.style.display = "inline-block";
      };
      reader.readAsDataURL(file);
    });

    // ===== –õ–æ–≥–∏–∫–∞ –ø–∞–Ω–µ–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ (—à–µ—Å—Ç–µ—Ä—ë–Ω–∫–∞) =====
    const settingsBtn = document.getElementById('settingsBtn');
    const settingsPanel = document.getElementById('settingsPanel');
    const themeRadios = document.querySelectorAll('input[name="theme"]');

    // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–º—É
    const savedTheme = localStorage.getItem('fchat-theme') || 'light';
    document.body.classList.remove('theme-light','theme-dark','theme-lumia','theme-Keket');
    document.body.classList.add(`theme-${savedTheme}`);
    themeRadios.forEach(r => r.checked = r.value === savedTheme);

    // –û—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ –ø–∞–Ω–µ–ª–∏
    settingsBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      const open = settingsPanel.style.display === 'block';
      settingsPanel.style.display = open ? 'none' : 'block';
    });

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ
    document.addEventListener('click', (e) => {
      if (!settingsPanel.contains(e.target) && e.target !== settingsBtn) {
        settingsPanel.style.display = 'none';
      }
    });

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã
    themeRadios.forEach(radio => {
      radio.addEventListener('change', (e) => {
        const val = e.target.value; // 'light' | 'dark' | 'lumia' | 'Keket'
        document.body.classList.remove('theme-light','theme-dark','theme-lumia','theme-Keket','theme-cosmos');
        document.body.classList.add(`theme-${val}`);
        localStorage.setItem('fchat-theme', val);
        updateButtons();
      });
    });

    // –ü–µ—Ä–≤—ã–π —Ä–µ–Ω–¥–µ—Ä –∫–Ω–æ–ø–æ–∫
    updateButtons();
// –≤—Å—Ç–∞–≤–∫–∞ —ç–º–æ–¥–∑–∏ –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞
function addEmoji(emoji) {
  const input = document.getElementById('text');
  input.value += emoji;
  input.focus();
}

// –æ—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ –ø–∞–Ω–µ–ª–∏
document.getElementById('emojiBtn').onclick = () => {
  const panel = document.getElementById('emojiPanel');
  panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
};

// –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –ø–æ –∫–Ω–æ–ø–∫–∞–º –ø–∞–Ω–µ–ª–∏
document.getElementById('emojiPanel').addEventListener('click', (e) => {
  if (e.target.tagName === 'BUTTON') {
    addEmoji(e.target.textContent);
  }
});

  </script>
<script>
  function generateID() {
    return Math.floor(10000 + Math.random() * 90000);
  }

  let userID = localStorage.getItem('fchat_user_id');
  if (!userID) {
    userID = generateID();
    localStorage.setItem('fchat_user_id', userID);
  }

  // –ú–µ–Ω—è–µ–º title —Å—Ä–∞–∑—É
  document.title = `Fchat ‚Äî —á–∞—Ç —Å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–æ–º | –í–∞—à ID: ${userID}`;

  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –º–æ–∂–Ω–æ –≤—Å—Ç–∞–≤–∏—Ç—å ID –≤ —à–∞–ø–∫—É
  const header = document.getElementById("chat-header");
  if (header) {
    header.innerHTML += ` <span style="color:gray; font-size:14px;">–í–∞—à ID: ${userID}</span>`;
  }
</script>


<footer style="text-align:center; padding:10px; font-size:14px; color:#888;">
  ¬© Ikogdash, 2025
</footer>
</body>
</html>

