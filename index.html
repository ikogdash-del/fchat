<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>Fchat</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }

    /* –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ */
    body.theme-light {
      --bg: #f0f2f5;
      --text: #1b1f26;
      --panel: #ffffff;
      --panel-border: #cccccc;
      --chat-bg: #ffffff;
      --chat-border: #cccccc;
      --bubble-incoming: #808080;
      --bubble-outgoing: #808080;
      --bubble-text: #1b1f26;
      --nickname: #000000; 
    }

    /* –¢—ë–º–Ω–∞—è —Ç–µ–º–∞ */
    body.theme-dark {
      --bg: #1e1e1e;
      --text: #e6e6e6;
      --panel: #2a2a2a;
      --panel-border: #444444;
      --chat-bg: #2a2a2a;
      --chat-border: #444444;
      --bubble-incoming: #808080;
      --bubble-outgoing: #808080;
      --bubble-text: #ffffff;
      --nickname: #000000;
    }

    /* üåû –õ—é–º–∏—è */
    body.theme-lumia {
      --bg: #FAF9F6;
      --text: #333333;
      --panel: #F5EEDC;
      --panel-border: #DDDDDD;
      --chat-bg: #FFFFFF;
      --chat-border: #DDDDDD;
      --bubble-incoming: #FFF9C4;
      --bubble-outgoing: #FFF176; 
      --bubble-text: #333333;
      --nickname: #B8860B;
    }

    /* üåë –ö–µ–∫–µ—Ç */
    body.theme-Keket {
      --bg: #000000;
      --text: #FFFFFF;
      --panel: #808080;
      --panel-border: #8A2BE2;
      --chat-bg: #262626;
      --chat-border: #8A2BE2;
      --bubble-incoming: #7FFFD4;
      --bubble-outgoing: #4B0082;
      --bubble-text: #FFFFFF;
      --nickname: #7FFFD4; 
    }

    /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ */
    body { background: var(--bg); color: var(--text); transition: background 200ms ease, color 200ms ease; }

    #chat {
      border:1px solid var(--chat-border);
      padding:10px;
      height:300px;
      overflow:auto;
      margin:0 500px 10px 0; /* –æ—Ç—Å—Ç—É–ø —Å–ø—Ä–∞–≤–∞ */
      background:var(--chat-bg);
      border-radius:8px;
    }

    .msg { display:flex; align-items:flex-start; margin:8px 0; }
    .avatar { width:40px; height:40px; border-radius:50%; margin-right:8px; object-fit:cover; border:1px solid #aaa; }

    .bubble { position:relative; padding:8px 12px; border-radius:12px; max-width:70%; word-wrap:break-word; }
    .bubble.incoming { background: var(--bubble-incoming); color: var(--bubble-text); }
    .bubble.outgoing { background: var(--bubble-outgoing); color: var(--bubble-text); }

    .nick { font-weight:bold; margin-right:6px; color: var(--nickname); }
    .time { display:block; font-size:11px; color:#555; text-align:right; margin-top:4px; }

    .deleteBtn { position:absolute; top:-10px; right:-10px; background:#e63946; border:none; border-radius:50%; width:22px; height:22px; color:#fff; cursor:pointer; font-size:14px; line-height:22px; text-align:center; display:none; }
    .bubble:hover .deleteBtn { display:block; }

    .chatImage { max-width:200px; border-radius:8px; margin-top:5px; }

    input, button { padding:6px; border:1px solid #ccc; border-radius:6px; margin:2px; cursor:pointer; }
    #sendBtn { background:#666; color:#fff; }
    #sendBtn:hover { background:#444; }

    .color-btn { width:140px; height:30px; color:#fff; border:none; border-radius:6px; cursor:pointer; }
    #avatarPreview { width:40px; height:40px; border:1px solid #aaa; border-radius:50%; object-fit:cover; margin-left:10px; vertical-align:middle; display:none; }

    #settingsBtn { position: fixed; right: 12px; top: 12px; background: var(--panel); border: 1px solid var(--panel-border); border-radius: 8px; padding: 6px 8px; cursor: pointer; z-index: 1000; }
    #settingsPanel { position: fixed; right: 12px; top: 52px; width: 240px; background: var(--panel); border: 1px solid var(--panel-border); border-radius: 12px; padding: 10px 12px; box-shadow: 0 10px 24px rgba(0,0,0,0.25); display: none; z-index: 1001; }
    #settingsPanel .row { margin:6px 0; }
    #settingsPanel input[type="radio"] { accent-color: #3b82f6; }
</style>
</head>
<body class="theme-light">
  <h2>Fchat</h2>

  <!-- –ü–∞–Ω–µ–ª—å –≤—ã–±–æ—Ä–∞ —Ç–µ–º—ã -->
  <button id="settingsBtn" aria-label="–û—Ç–∫—Ä—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">‚öôÔ∏è</button>
  <div id="settingsPanel" role="dialog" aria-modal="true" aria-label="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">
    <div class="row"><strong>–¢–µ–º–∞:</strong></div>
    <div class="row"><label><input type="radio" name="theme" value="light"> –°–≤–µ—Ç–ª–∞—è</label></div>
    <div class="row"><label><input type="radio" name="theme" value="dark"> –¢—ë–º–Ω–∞—è</label></div>
    <div class="row"><label><input type="radio" name="theme" value="lumia"> –õ—é–º–∏—è</label></div>
    <div class="row"><label><input type="radio" name="theme" value="Keket"> –ö–µ–∫–µ—Ç</label></div>
  </div>

  <div id="chat"></div>

  <div>
    <input id="nick" placeholder="–í–∞—à –Ω–∏–∫">
    <input id="nickColorInput" type="color" style="display:none;">
    <input id="bubbleColorInput" type="color" style="display:none;">
    <button id="nickColorBtn" class="color-btn">–¶–≤–µ—Ç –Ω–∏–∫–∞</button>
    <button id="bubbleColorBtn" class="color-btn">–¶–≤–µ—Ç –æ–±–ª–∞—á–∫–∞</button>
    <input id="avatarInput" type="file" accept="image/*" style="display:none;">
    <button id="avatarBtn">–í—ã–±—Ä–∞—Ç—å –∞–≤–∞—Ç–∞—Ä–∫—É</button>
    <img id="avatarPreview" src="" alt="–ü—Ä–µ–≤—å—é">
  </div>

  <div>
    <input id="text" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ" style="width:300px;">
    <input id="fileInput" type="file" accept="image/*">
    <button id="sendBtn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
  </div>

  <!-- Firebase compat -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

  <script>
    // –¢–≤–æ–π –∫–æ–Ω—Ñ–∏–≥ (–∏–∑ –≤—Ç–æ—Ä–æ–π —á–∞—Å—Ç–∏)
    const firebaseConfig = {
      apiKey: "AIzaSyATNSmCPnM1og0SO-zJsfD2w9AVC00wiBg",
      authDomain: "fchat-f223c.firebaseapp.com",
      databaseURL: "https://fchat-f223c-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "fchat-f223c",
      storageBucket: "fchat-f223c.appspot.com",
      messagingSenderId: "850391832152",
      appId: "1:850391832152:web:39c320446cd898c7859c2d",
      measurementId: "G-1EVPFPZHPF"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // –õ–æ–∫–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
    let avatarData = "";
    let nickColor = "";     // –ø—É—Å—Ç–æ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ü–≤–µ—Ç —Ç–µ–º—ã (--nickname)
    let bubbleColor = "";   // –ø—É—Å—Ç–æ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ü–≤–µ—Ç —Ç–µ–º—ã (--bubble-outgoing)

    function updateButtons() {
      const themeNick = getComputedStyle(document.body).getPropertyValue('--nickname').trim();
      document.getElementById('nickColorBtn').style.backgroundColor = nickColor || themeNick;

      const outgoingDefault = getComputedStyle(document.body).getPropertyValue('--bubble-outgoing').trim();
      document.getElementById('bubbleColorBtn').style.backgroundColor = bubbleColor || outgoingDefault;

      if (avatarData) {
        const preview = document.getElementById('avatarPreview');
        preview.src = avatarData;
        preview.style.display = "inline-block";
      }
    }

    function addMessage(msg, key) {
      const chat = document.getElementById('chat');
      const wrapper = document.createElement('div');
      wrapper.className = "msg";

      if (msg.avatar) {
        const img = document.createElement('img');
        img.className = "avatar";
        img.src = msg.avatar;
        wrapper.appendChild(img);
      }

      const bubbleEl = document.createElement('div');
      const currentNick = document.getElementById('nick').value.trim() || "Anon";
      const isOutgoing = msg.nick === currentNick;
      bubbleEl.className = "bubble " + (isOutgoing ? "outgoing" : "incoming");

      if (msg.bubbleColor) {
        bubbleEl.style.backgroundColor = msg.bubbleColor;
      }

      const themeNick = getComputedStyle(document.body).getPropertyValue('--nickname').trim();
      const textEl = document.createElement('div');
      textEl.innerHTML = `<span class="nick" style="color:${msg.color || themeNick}">${msg.nick}:</span> ${msg.text || ''}`;
      bubbleEl.appendChild(textEl);

      if (msg.image) {
        const imgEl = document.createElement('img');
        imgEl.className = "chatImage";
        imgEl.src = msg.image;
        bubbleEl.appendChild(imgEl);
      }

      const timeEl = document.createElement('div');
      timeEl.className = "time";
      timeEl.textContent = msg.time || '';
      bubbleEl.appendChild(timeEl);

      const delBtn = document.createElement('button');
      delBtn.className = "deleteBtn";
      delBtn.textContent = "X";
      delBtn.onclick = () => {
        db.ref("messages/" + key).remove().catch(err => {
          console.error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è:", err);
          alert("–£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å: " + err.code);
        });
        wrapper.remove();
      };
      bubbleEl.appendChild(delBtn);

      wrapper.appendChild(bubbleEl);
      chat.appendChild(wrapper);
      chat.scrollTop = chat.scrollHeight;
    }

    function send() {
      const nick = document.getElementById('nick').value.trim() || "Anon";
      const text = document.getElementById('text').value.trim();
      const fileInput = document.getElementById('fileInput');
      const file = fileInput.files[0];

      if (!text && !file) return;

      const now = new Date();
      const timeStr = now.getHours().toString().padStart(2,'0') + ":" + now.getMinutes().toString().padStart(2,'0');

      const msg = {
        nick,
        text,
        color: nickColor || "",     // –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ü–≤–µ—Ç –Ω–∏–∫–∞ (–µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω)
        avatar: avatarData,
        bubbleColor: bubbleColor || "",
        time: timeStr
      };

      const writeMsg = (m) => {
        const ref = db.ref("messages").push();
        ref.set(m).catch(err => {
          console.error("–û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏:", err);
          alert("–ó–∞–ø–∏—Å—å –Ω–µ —É–¥–∞–ª–∞—Å—å: " + err.code);
        });
      };

      if (file) {
        const reader = new FileReader();
        reader.onload = ev => { msg.image = ev.target.result; writeMsg(msg); };
        reader.readAsDataURL(file);
      } else {
        writeMsg(msg);
      }

      document.getElementById('text').value = '';
      fileInput.value = '';
    }

    // –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    db.ref("messages").on("child_added", snapshot => {
      addMessage(snapshot.val(), snapshot.key);
    }, err => {
      console.error("–û—à–∏–±–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏:", err);
      alert("–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —á—Ç–µ–Ω–∏—é: " + err.code);
    });

    // UI —Å–æ–±—ã—Ç–∏—è
    document.getElementById('sendBtn').onclick = send;
    document.getElementById('text').addEventListener("keydown", e => {
      if (e.key === "Enter") { e.preventDefault(); send(); }
    });

    document.getElementById('nickColorBtn').onclick = () => document.getElementById('nickColorInput').click();
    document.getElementById('bubbleColorBtn').onclick = () => document.getElementById('bubbleColorInput').click();

    document.getElementById('nickColorInput').addEventListener("input", e => {
      nickColor = e.target.value;
      updateButtons();
    });
    document.getElementById('bubbleColorInput').addEventListener("input", e => {
      bubbleColor = e.target.value;
      updateButtons();
    });

    document.getElementById('avatarBtn').onclick = () => document.getElementById('avatarInput').click();
    document.getElementById('avatarInput').addEventListener("change", e => {
      const file = e.target.files[0]; if (!file) return;
      const reader = new FileReader();
      reader.onload = ev => {
        avatarData = ev.target.result;
        const preview = document.getElementById('avatarPreview');
        preview.src = avatarData;
        preview.style.display = "inline-block";
      };
      reader.readAsDataURL(file);
    });

    // ===== –õ–æ–≥–∏–∫–∞ –ø–∞–Ω–µ–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ (—à–µ—Å—Ç–µ—Ä—ë–Ω–∫–∞) =====
    const settingsBtn = document.getElementById('settingsBtn');
    const settingsPanel = document.getElementById('settingsPanel');
    const themeRadios = document.querySelectorAll('input[name="theme"]');

    // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–º—É
    const savedTheme = localStorage.getItem('fchat-theme') || 'light';
    document.body.classList.remove('theme-light','theme-dark','theme-lumia','theme-Keket');
    document.body.classList.add(`theme-${savedTheme}`);
    themeRadios.forEach(r => r.checked = r.value === savedTheme);

    // –û—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ –ø–∞–Ω–µ–ª–∏
    settingsBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      const open = settingsPanel.style.display === 'block';
      settingsPanel.style.display = open ? 'none' : 'block';
    });

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ
    document.addEventListener('click', (e) => {
      if (!settingsPanel.contains(e.target) && e.target !== settingsBtn) {
        settingsPanel.style.display = 'none';
      }
    });

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã
    themeRadios.forEach(radio => {
      radio.addEventListener('change', (e) => {
        const val = e.target.value; // 'light' | 'dark' | 'lumia' | 'Keket'
        document.body.classList.remove('theme-light','theme-dark','theme-lumia','theme-Keket');
        document.body.classList.add(`theme-${val}`);
        localStorage.setItem('fchat-theme', val);
        updateButtons();
      });
    });

    // –ü–µ—Ä–≤—ã–π —Ä–µ–Ω–¥–µ—Ä –∫–Ω–æ–ø–æ–∫
    updateButtons();
  </script>
  <footer style="text-align:center; padding:10px; font-size:14px; color:#888;">
  ¬© Ikogdash, 2025
</footer>
</body>
</html>




























